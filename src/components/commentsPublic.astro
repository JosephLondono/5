---
import { getSession } from 'auth-astro/server';
import { db, Users, Comments, eq } from 'astro:db';
import { ne } from 'astro:db';

const session = await getSession(Astro.request);

let CommentsDataPublic = [];
if(session!==null){
    const userCurrent = await db.select().from(Users).where(eq(Users.email, session.user.email));

    const CommentsData1 = await db.select().from(Comments).where(ne(Comments.userId, userCurrent[0].id)).innerJoin(Users, eq(Comments.userId, Users.id))
	console.log(CommentsData1)

	CommentsDataPublic = await db.select().from(Comments).where(eq(Comments.isPublic, true)).innerJoin(Users, eq(Comments.userId, Users.id))
}

---
{
    (CommentsDataPublic.length === 0) ? (<h3 class="text-start m-0 text-xl">No comments Public</h3>) :
    (
        <h3 class="text-start m-0 text-xl">Comments Personal</h3>
        <ul class="space-y-4">
                {
                    CommentsDataPublic.map((commentsPublic) => (
                        <li class="border p-2 rounded shadow dark:border-gray-700 dark:bg-gray-900">
                            <h3 class="text-xl font-semibold">{ commentsPublic.Comments.title }</h3>
                            <span class="block text-gray-600 dark:text-gray-400">{commentsPublic.Comments.description}</span>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Author: {commentsPublic.Users.name}</p>
                                {
                                    (commentsPublic.Comments.completed) ? <span class="text-green-500 dark:text-green-400">Completed</span> : <span class="text-red-500 dark:text-red-400">Not Completed</span>
                                }
                        </li>
                    ))
                }
            </ul>
        )
}